# Hash 取模
作用是索引数据，将主键分片到不同的节点。

## 哈希取模的弊端
```
index = hash(key) % N
```

### 初始化状态
假设N=10，并选取key为随机数34,67,23,40,69,16
        
|Node number|0 |1 |2 |3|4|5|6|7|8|9|
|:--------:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
|  假设hash(key)=key    |k40  |  |   | k23  | k34  | k15  |  | k67 |   | k69 | 

也就是   
```
34 % 10 = 4
67 % 10 = 7
23 % 10 = 3
40 % 10 = 0 
69 % 10 = 9
15 % 10 = 5
``` 
### 删除一个结点
删除任意一个节点后，结点数N=9，`hash(key) % N`为 `hash(key) % 9`
```
34 % 9 = 7 之前为 4，失效
67 % 9 = 4 之前为 7，失效
23 % 9 = 5 之前为 3，失效
40 % 9 = 4 之前为 0，失效
69 % 9 = 6 之前为 9，失效
15 % 9 = 6 之前为 5，失效
```

### 增加一个结点
增加任意一个节点后，节点数N=11，`hash(key) % N`为 `hash(key) % 11`
```
34 % 11 = 1 之前为 4，失效
67 % 11 = 1 之前为 7，失效
23 % 11 = 1 之前为 3，失效
40 % 11 = 7 之前为 0，失效
69 % 11 = 3 之前为 9，失效
15 % 11 = 4 之前为 5，失效
```

结论，无论是增加还是删除节点，当节点数N变化后，之前的hash映射关系都会大面积地失效。所以，分布式情形下，一般会选择一致哈希算法。